<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoopShaper</title>

    <!-- Dockview CSS -->
    <link rel="stylesheet" href="https://unpkg.com/dockview-core@4.13.1/dist/styles/dockview.css">

    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Toolbar -->
    <div id="toolbar">
        <div class="toolbar-left">
            <span class="app-title">LoopShaper</span>
        </div>
        <div class="toolbar-right">
            <div class="dropdown">
                <button class="btn btn-sm btn-toolbar" id="btn-view-menu">
                    View â–¾
                </button>
                <div class="dropdown-menu" id="view-menu">
                    <!-- Menu items will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Dockview Container (for wide screens) -->
    <div id="dockview-container" class="dockview-theme-light"></div>

    <!-- Narrow Screen Layout (for mobile) -->
    <div id="narrow-layout">
        <div class="narrow-panel">
            <div class="narrow-panel-header">System Definition</div>
            <div class="panel-content">
                <textarea class="form-control font-monospace" id="narrow-field-code" rows="3" spellcheck="false"></textarea>
                <div class="tf-row mt-2">
                    <span id="narrow-eq-L-display" class="eq-display-inline"></span>
                </div>
                <div class="tf-row">
                    <span id="narrow-eq-T-display" class="eq-display-inline"></span>
                </div>
            </div>
        </div>
        <div class="narrow-panel">
            <div class="narrow-panel-header">Parameters</div>
            <div class="panel-content">
                <div class="slider-header">
                    <span>Name</span>
                    <span>Min</span>
                    <span>Max</span>
                    <span>Log</span>
                    <span></span>
                </div>
                <div id="narrow-sliders-container"></div>
                <button class="btn btn-sm btn-primary mt-2" id="narrow-btn-add-slider">+ Add</button>
            </div>
        </div>
        <div class="narrow-panel">
            <div class="narrow-plot-tabs">
                <button class="narrow-tab-btn active" data-tab="bode">Bode Plot</button>
                <button class="narrow-tab-btn" data-tab="pole-zero">Pole-Zero Map</button>
            </div>
            <div class="panel-content panel-plot" id="narrow-tab-bode">
                <div class="bode-options">
                    <div class="form-check form-check-inline mb-0">
                        <input class="form-check-input" type="checkbox" id="narrow-chk-show-L" checked>
                        <label class="form-check-label bode-label-L" for="narrow-chk-show-L">&#9473; $L(s)$</label>
                    </div>
                    <div class="form-check form-check-inline mb-0">
                        <input class="form-check-input" type="checkbox" id="narrow-chk-show-T" checked>
                        <label class="form-check-label bode-label-T" for="narrow-chk-show-T">&#9473; $T(s)$</label>
                    </div>
                </div>
                <div id="narrow-bode-wrapper" class="plot-wrapper narrow-plot-wrapper">
                    <canvas id="narrow-bode-canvas"></canvas>
                </div>
            </div>
            <div class="panel-content panel-plot" id="narrow-tab-pole-zero" style="display: none;">
                <div class="pole-options">
                    <div class="form-check form-check-inline mb-0">
                        <input class="form-check-input" type="checkbox" id="narrow-chk-show-L-pz" checked>
                        <label class="form-check-label pole-label-L" for="narrow-chk-show-L-pz">L(s)</label>
                    </div>
                    <div class="form-check form-check-inline mb-0">
                        <input class="form-check-input" type="checkbox" id="narrow-chk-show-T-pz" checked>
                        <label class="form-check-label pole-label-T" for="narrow-chk-show-T-pz">T(s)</label>
                    </div>
                </div>
                <div id="narrow-pole-wrapper" class="plot-wrapper narrow-plot-wrapper">
                    <canvas id="narrow-pole-canvas"></canvas>
                </div>
            </div>
        </div>
        <div class="narrow-panel">
            <div class="narrow-panel-header">Stability</div>
            <div class="panel-content">
                <div class="stability-header">
                    <span class="stability-label">Stability</span>
                    <span id="narrow-stability-indicator" class="badge bg-secondary">--</span>
                </div>
                <div class="stability-info">
                    <div class="info-row">
                        <strong>GM:</strong>
                        <span id="narrow-gm-display" class="text-muted">--</span>
                    </div>
                    <div class="info-row">
                        <strong>PM:</strong>
                        <span id="narrow-pm-display" class="text-muted">--</span>
                    </div>
                </div>
                <div class="poles-section">
                    <strong>Poles:</strong>
                    <span id="narrow-clp-display" class="text-muted"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel Templates -->
    <template id="template-system-definition">
        <div class="panel-content">
            <textarea class="form-control font-monospace" id="field-code" rows="3" spellcheck="false"></textarea>
            <div class="tf-row mt-2">
                <span id="eq-L-display" class="eq-display-inline"></span>
            </div>
            <div class="tf-row">
                <span id="eq-T-display" class="eq-display-inline"></span>
            </div>
        </div>
    </template>

    <template id="template-parameters">
        <div class="panel-content">
            <div class="slider-header">
                <span>Name</span>
                <span>Min</span>
                <span>Max</span>
                <span>Log</span>
                <span></span>
            </div>
            <div id="sliders-container"></div>
            <button class="btn btn-sm btn-primary mt-2" id="btn-add-slider">+ Add</button>
        </div>
    </template>

    <template id="template-bode">
        <div class="panel-content panel-plot">
            <div class="bode-options">
                <div class="form-check form-check-inline mb-0">
                    <input class="form-check-input" type="checkbox" id="chk-show-L" checked>
                    <label class="form-check-label bode-label-L" for="chk-show-L">&#9473; $L(s)$</label>
                </div>
                <div class="form-check form-check-inline mb-0">
                    <input class="form-check-input" type="checkbox" id="chk-show-T" checked>
                    <label class="form-check-label bode-label-T" for="chk-show-T">&#9473; $T(s)$</label>
                </div>
            </div>
            <div id="bode-wrapper" class="plot-wrapper">
                <canvas id="bode-canvas"></canvas>
            </div>
        </div>
    </template>

    <template id="template-stability">
        <div class="panel-content">
            <div class="stability-header">
                <span class="stability-label">Stability</span>
                <span id="stability-indicator" class="badge bg-secondary">--</span>
            </div>
            <div class="stability-info">
                <div class="info-row">
                    <strong>GM:</strong>
                    <span id="gm-display" class="text-muted">--</span>
                </div>
                <div class="info-row">
                    <strong>PM:</strong>
                    <span id="pm-display" class="text-muted">--</span>
                </div>
            </div>
            <div class="poles-section">
                <strong>Poles:</strong>
                <span id="clp-display" class="text-muted"></span>
            </div>
        </div>
    </template>

    <template id="template-frequency">
        <div class="panel-content">
            <div class="freq-header">
                <div class="form-check mb-0">
                    <input class="form-check-input" type="checkbox" id="chk-freq-auto" checked>
                    <label class="form-check-label" for="chk-freq-auto">Auto</label>
                </div>
            </div>
            <div class="freq-inputs">
                <div class="input-group input-group-sm">
                    <span class="input-group-text">Min</span>
                    <input type="number" class="form-control" id="field-freq-min" value="-2" step="0.5">
                </div>
                <div class="input-group input-group-sm">
                    <span class="input-group-text">Max</span>
                    <input type="number" class="form-control" id="field-freq-max" value="3" step="0.5">
                </div>
            </div>
        </div>
    </template>

    <template id="template-pole-zero">
        <div class="panel-content panel-plot">
            <div class="pole-options">
                <div class="form-check form-check-inline mb-0">
                    <input class="form-check-input" type="checkbox" id="chk-show-L-pz" checked>
                    <label class="form-check-label pole-label-L" for="chk-show-L-pz">L(s)</label>
                </div>
                <div class="form-check form-check-inline mb-0">
                    <input class="form-check-input" type="checkbox" id="chk-show-T-pz" checked>
                    <label class="form-check-label pole-label-T" for="chk-show-T-pz">T(s)</label>
                </div>
            </div>
            <div id="pole-wrapper" class="plot-wrapper">
                <canvas id="pole-canvas"></canvas>
            </div>
        </div>
    </template>

    <!-- KaTeX JS -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Math.js -->
    <script src="https://unpkg.com/mathjs@15.1.0/lib/browser/math.js"></script>

    <!-- Dockview JS -->
    <script src="https://unpkg.com/dockview-core@4.13.1/dist/dockview-core.js"></script>

    <!-- Pako (zlib) for URL compression -->
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>

    <!-- Custom JS -->
    <script src="utils.js"></script>
    <script src="bode.js"></script>
    <script src="main.js"></script>
</body>
</html>
